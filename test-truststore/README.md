# Test adding custom Certificate Authority into Docker Trust Store

<<<<<<< HEAD
## 1. Self Signed Certificate Creation
=======
## Self Signed Certificate Creation
>>>>>>> 2dbfbd8ad92596596fcae5a6aa1b9c56d927440f

### Install mkcert 

Please follow the installation instruction here. 
https://github.com/FiloSottile/mkcert

Here, I includes a pre-compiled mkcert for linx/windows.


### Create certificate using mkcert

```
export CAROOT=$(pwd)

./mkcert -key-file myKey.key -cert-file myKey.crt dev.mio "*.dev.mio" localhost 127.0.0.1 ::1

```

Above command will create a self-signed certificate for domains (dev.mio, *.dev.mio using a pair of CaRoot files (named: myCA.pem & myCA-key.pem ) on current directory. Output key will be saved on myKey.key and myKey.crt

## 2. Install rootCA to Docker trust store

```

COPY ./myCA.pem /usr/local/share/ca-certificates/myCA.crt
RUN update-ca-certificates

```

## 3. Test rootCA successful copied into trust store

```

cat /etc/ssl/certs/ca-certificates.crt 

```

Check that the content of your myCA.pem existed in the file */etc/ssl/certs/ca-certificates.crt *


## 4. Verify using Curl
-   Run docker container **containous/whoami** using self-signed certificate (generated by your CA).
<<<<<<< HEAD
-   Run other container which have CA installed to the trust-store then using curl -v (verbose) or openssl to verify your certificate.


```
    openssl s_client -showcerts -servername whoami.dev.mio -connect whoami.dev.mio:80
=======
-   Run other container which have CA installed to the trust-store then using curl -v (verbose) to verify your certificate.

```
>>>>>>> 2dbfbd8ad92596596fcae5a6aa1b9c56d927440f

    curl -v https://whoami.dev.mio:80/api

```    

Below is the whole docker-compose file to run and verify.

```

version: "3.5"

services:
    whoami:
        image: containous/whoami        
        container_name: whoami.dev.mio 
        volumes: 
            - .:/certs
        command: 
            --cert /certs/myKey.crt --key /certs/myKey.key

    verifySSL:
        depends_on: 
            - whoami
        image: devops/trust-store
        build:
            context: .
            dockerfile: Dockerfile                
        command: 
<<<<<<< HEAD
            openssl s_client -showcerts -servername whoami.dev.mio -connect whoami.dev.mio:80

```

=======
            curl -v https://whoami.dev.mio:80/api

```
>>>>>>> 2dbfbd8ad92596596fcae5a6aa1b9c56d927440f
